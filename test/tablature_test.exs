defmodule TablatureTest do
  use ExUnit.Case

  test "Ode to joy, part 1" do
    tab = """
          e|-------------------------------|
          B|-5-5-6-8-8-6-5-3-1-1-3-5-5-3-3-|
          G|-------------------------------|
          D|-------------------------------|
          A|-------------------------------|
          E|-------------------------------|
          """
    expected = "_ B5 _ B5 _ B6 _ B8 _ B8 _ B6 _ B5 _ B3 _ B1 _ B1 _ B3 _ B5 _ B5 _ B3 _ B3 _"
    assert Tablature.parse(tab) == expected
  end

  test "Ode to joy, part 2" do
    tab = """
          e|-------------------------------|
          B|-5-5-6-8-8-6-5-3-1-1-3-5-3-1-1-|
          G|-------------------------------|
          D|-------------------------------|
          A|-------------------------------|
          E|-------------------------------|
          """
    expected = "_ B5 _ B5 _ B6 _ B8 _ B8 _ B6 _ B5 _ B3 _ B1 _ B1 _ B3 _ B5 _ B3 _ B1 _ B1 _"
    assert Tablature.parse(tab) == expected
  end

  test "Romanza" do
    tab = """
          e|-7-----7-----7-----7-----5-----3-----3-----2-----0-----0-----|
          B|---0-----0-----0-----0-----0-----0-----0-----0-----0-----0---|
          G|-----0-----0-----0-----0-----0-----0-----0-----0-----0-----0-|
          D|-------------------------------------------------------------|
          A|-------------------------------------------------------------|
          E|-------------------------------------------------------------|
          """
    expected = "_ e7 _ B0 _ G0 _ _ e7 _ B0 _ G0 _ _ e7 _ B0 _ G0 _ _ e7 _ B0 _ G0 _ _ e5 _ B0 _ G0 _ _ e3 _ B0 _ G0 _ _ e3 _ B0 _ G0 _ _ e2 _ B0 _ G0 _ _ e0 _ B0 _ G0 _ _ e0 _ B0 _ G0 _ _"
    assert Tablature.parse(tab) == expected
  end

  test "Stairway to Heaven" do
    tab = """
          e|-------5-7-----7-8-----8-2-----2-0-------0-0-----------|
          B|-----5-----5-------5-------3-------1---1-----1---0-1-1-|
          G|---5---------5-------5-------2-------2---------2-------|
          D|-7-----------------------------------------------------|
          A|-------------------------------------------------------|
          E|-------------------------------------------------------|
          """
    expected = "_ D7 _ G5 _ B5 _ _ e5 _ e7 _ B5 _ G5 _ e7 _ e8 _ B5 _ G5 _ e8 _ e2 _ B3 _ G2 _ e2 _ e0 _ B1 _ G2 _ B1 _ e0 _ e0 _ B1 _ G2 _ B0 _ B1 _ B1 _ _ _ _ _ _ _ _ _"
    assert Tablature.parse(tab) == expected
  end

  test "Stairway to Heaven (multiple strings)" do
    tab = """
    e|-------5-7-----7-|
    B|-----5-----5-----|
    G|---5---------5---|
    D|-7-------6-------|
    A|-----------------|
    E|-----------------|
    """
    expected = "_ D7 _ G5 _ B5 _ _ e5 _ e7/D6 _ B5 _ G5 _ e7 _"
    assert Tablature.parse(tab) == expected
  end

  test "Stairway to Heaven (multiple segments)" do
    tab = """
    e|-------5-7-----7-|-8-----8-2-----2-|-0---------0-----|-----------------|
    B|-----5-----5-----|---5-------3-----|---1---1-----1---|-0-1-1-----------|
    G|---5---------5---|-----5-------2---|-----2---------2-|-0-2-2---2-------|
    D|-7-------6-------|-5-------4-------|-3---------------|-----------------|
    A|-----------------|-----------------|-----------------|-2-0-0---0---8-7-|
    E|-----------------|-----------------|-----------------|-----------------|
    e|---------7-----7-|-8-----8-2-----2-|-0---------0-----|-----------------|
    B|-------5---5-----|---5-------3-----|---1---1-----1---|-0-1-1-----------|
    G|-----5-------5---|-----5-------2---|-----2---------2-|-0-2-2-----------|
    D|---7-----6-------|-5-------4-------|-3---------------|-----------------|
    A|-0---------------|-----------------|-----------------|-2-0-0-------0-2-|
    E|-----------------|-----------------|-----------------|-----------------|
    """
    expected = "_ D7 _ G5 _ B5 _ _ e5 _ e7/D6 _ B5 _ G5 _ e7 _ e8/D5 _ B5 _ G5 _ e8 _ e2/D4 _ B3 _ G2 _ e2 _ e0/D3 _ B1 _ G2 _ B1 _ _ e0 _ B1 _ G2 _ B0/G0/A2 _ B1/G2/A0 _ B1/G2/A0 _ _ G2/A0 _ A8 _ A7 _ A0 _ D7 _ G5 _ B5 _ _ _ e7/D6 _ B5 _ G5 _ e7 _ e8/D5 _ B5 _ G5 _ e8 _ e2/D4 _ B3 _ G2 _ e2 _ e0/D3 _ B1 _ G2 _ B1 _ _ e0 _ B1 _ G2 _ B0/G0/A2 _ B1/G2/A0 _ B1/G2/A0 _ _ _ _ A0 A2"
    assert Tablature.parse(tab) == expected
  end
end
